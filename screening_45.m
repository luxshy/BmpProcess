global im
A4=im;

[M4,N4]=size(A4);%图像大小
A4=double(A4);%转换数据类型
B4=imresize(A4,12);%放大
[m,n]=size(B4);
C4=zeros(m,n);
KK=[
128,120,109,92,74,66,46,8,15,10,64,79,97,111,122,127,128,120,109,92,74,66,46,8,15,10,64,79,97,111,122,127,128,120,109,92,74,66,46,8,15,10,64,79,97,111,122,127
123,116,87,69,62,38,6,39,42,3,19,55,86,105,115,119,123,116,87,69,62,38,6,39,42,3,19,55,86,105,115,119,123,116,87,69,62,38,6,39,42,3,19,55,86,105,115,119
107,96,71,59,24,12,28,52,63,47,20,1,58,95,108,112,107,96,71,59,24,12,28,52,63,47,20,1,58,95,108,112,107,96,71,59,24,12,28,52,63,47,20,1,58,95,108,112
84,73,56,2,18,23,48,78,82,67,35,5,31,61,91,101,84,73,56,2,18,23,48,78,82,67,35,5,31,61,91,101,84,73,56,2,18,23,48,78,82,67,35,5,31,61,91,101
77,53,32,4,25,43,75,85,100,89,60,30,9,34,68,80,77,53,32,4,25,43,75,85,100,89,60,30,9,34,68,80,77,53,32,4,25,43,75,85,100,89,60,30,9,34,68,80
51,41,21,27,40,70,94,102,110,103,93,57,26,11,37,65,51,41,21,27,40,70,94,102,110,103,93,57,26,11,37,65,51,41,21,27,40,70,94,102,110,103,93,57,26,11,37,65
44,29,33,45,72,90,104,121,117,114,106,88,54,17,13,16,44,29,33,45,72,90,104,121,117,114,106,88,54,17,13,16,44,29,33,45,72,90,104,121,117,114,106,88,54,17,13,16
14,36,49,76,83,98,118,126,125,124,113,99,81,50,22,7,14,36,49,76,83,98,118,126,125,124,113,99,81,50,22,7,14,36,49,76,83,98,118,126,125,124,113,99,81,50,22,7
15,10,64,79,97,111,122,127,128,120,109,92,74,66,46,8,15,10,64,79,97,111,122,127,128,120,109,92,74,66,46,8,15,10,64,79,97,111,122,127,128,120,109,92,74,66,46,8
42,3,19,55,86,105,115,119,123,116,87,69,62,38,6,39,42,3,19,55,86,105,115,119,123,116,87,69,62,38,6,39,42,3,19,55,86,105,115,119,123,116,87,69,62,38,6,39
63,47,20,1,58,95,108,112,107,96,71,59,24,12,28,52,63,47,20,1,58,95,108,112,107,96,71,59,24,12,28,52,63,47,20,1,58,95,108,112,107,96,71,59,24,12,28,52
82,67,35,5,31,61,91,101,84,73,56,2,18,23,48,78,82,67,35,5,31,61,91,101,84,73,56,2,18,23,48,78,82,67,35,5,31,61,91,101,84,73,56,2,18,23,48,78
100,89,60,30,9,34,68,80,77,53,32,4,25,43,75,85,100,89,60,30,9,34,68,80,77,53,32,4,25,43,75,85,100,89,60,30,9,34,68,80,77,53,32,4,25,43,75,85
110,103,93,57,26,11,37,65,51,41,21,27,40,70,94,102,110,103,93,57,26,11,37,65,51,41,21,27,40,70,94,102,110,103,93,57,26,11,37,65,51,41,21,27,40,70,94,102
117,114,106,88,54,17,13,16,44,29,33,45,72,90,104,121,117,114,106,88,54,17,13,16,44,29,33,45,72,90,104,121,117,114,106,88,54,17,13,16,44,29,33,45,72,90,104,121
125,124,113,99,81,50,22,7,14,36,49,76,83,98,118,126,125,124,113,99,81,50,22,7,14,36,49,76,83,98,118,126,125,124,113,99,81,50,22,7,14,36,49,76,83,98,118,126
128,120,109,92,74,66,46,8,15,10,64,79,97,111,122,127,128,120,109,92,74,66,46,8,15,10,64,79,97,111,122,127,128,120,109,92,74,66,46,8,15,10,64,79,97,111,122,127
123,116,87,69,62,38,6,39,42,3,19,55,86,105,115,119,123,116,87,69,62,38,6,39,42,3,19,55,86,105,115,119,123,116,87,69,62,38,6,39,42,3,19,55,86,105,115,119
107,96,71,59,24,12,28,52,63,47,20,1,58,95,108,112,107,96,71,59,24,12,28,52,63,47,20,1,58,95,108,112,107,96,71,59,24,12,28,52,63,47,20,1,58,95,108,112
84,73,56,2,18,23,48,78,82,67,35,5,31,61,91,101,84,73,56,2,18,23,48,78,82,67,35,5,31,61,91,101,84,73,56,2,18,23,48,78,82,67,35,5,31,61,91,101
77,53,32,4,25,43,75,85,100,89,60,30,9,34,68,80,77,53,32,4,25,43,75,85,100,89,60,30,9,34,68,80,77,53,32,4,25,43,75,85,100,89,60,30,9,34,68,80
51,41,21,27,40,70,94,102,110,103,93,57,26,11,37,65,51,41,21,27,40,70,94,102,110,103,93,57,26,11,37,65,51,41,21,27,40,70,94,102,110,103,93,57,26,11,37,65
44,29,33,45,72,90,104,121,117,114,106,88,54,17,13,16,44,29,33,45,72,90,104,121,117,114,106,88,54,17,13,16,44,29,33,45,72,90,104,121,117,114,106,88,54,17,13,16
14,36,49,76,83,98,118,126,125,124,113,99,81,50,22,7,14,36,49,76,83,98,118,126,125,124,113,99,81,50,22,7,14,36,49,76,83,98,118,126,125,124,113,99,81,50,22,7
15,10,64,79,97,111,122,127,128,120,109,92,74,66,46,8,15,10,64,79,97,111,122,127,128,120,109,92,74,66,46,8,15,10,64,79,97,111,122,127,128,120,109,92,74,66,46,8
42,3,19,55,86,105,115,119,123,116,87,69,62,38,6,39,42,3,19,55,86,105,115,119,123,116,87,69,62,38,6,39,42,3,19,55,86,105,115,119,123,116,87,69,62,38,6,39
63,47,20,1,58,95,108,112,107,96,71,59,24,12,28,52,63,47,20,1,58,95,108,112,107,96,71,59,24,12,28,52,63,47,20,1,58,95,108,112,107,96,71,59,24,12,28,52
82,67,35,5,31,61,91,101,84,73,56,2,18,23,48,78,82,67,35,5,31,61,91,101,84,73,56,2,18,23,48,78,82,67,35,5,31,61,91,101,84,73,56,2,18,23,48,78
100,89,60,30,9,34,68,80,77,53,32,4,25,43,75,85,100,89,60,30,9,34,68,80,77,53,32,4,25,43,75,85,100,89,60,30,9,34,68,80,77,53,32,4,25,43,75,85
110,103,93,57,26,11,37,65,51,41,21,27,40,70,94,102,110,103,93,57,26,11,37,65,51,41,21,27,40,70,94,102,110,103,93,57,26,11,37,65,51,41,21,27,40,70,94,102
117,114,106,88,54,17,13,16,44,29,33,45,72,90,104,121,117,114,106,88,54,17,13,16,44,29,33,45,72,90,104,121,117,114,106,88,54,17,13,16,44,29,33,45,72,90,104,121
125,124,113,99,81,50,22,7,14,36,49,76,83,98,118,126,125,124,113,99,81,50,22,7,14,36,49,76,83,98,118,126,125,124,113,99,81,50,22,7,14,36,49,76,83,98,118,126
128,120,109,92,74,66,46,8,15,10,64,79,97,111,122,127,128,120,109,92,74,66,46,8,15,10,64,79,97,111,122,127,128,120,109,92,74,66,46,8,15,10,64,79,97,111,122,127
123,116,87,69,62,38,6,39,42,3,19,55,86,105,115,119,123,116,87,69,62,38,6,39,42,3,19,55,86,105,115,119,123,116,87,69,62,38,6,39,42,3,19,55,86,105,115,119
107,96,71,59,24,12,28,52,63,47,20,1,58,95,108,112,107,96,71,59,24,12,28,52,63,47,20,1,58,95,108,112,107,96,71,59,24,12,28,52,63,47,20,1,58,95,108,112
84,73,56,2,18,23,48,78,82,67,35,5,31,61,91,101,84,73,56,2,18,23,48,78,82,67,35,5,31,61,91,101,84,73,56,2,18,23,48,78,82,67,35,5,31,61,91,101
77,53,32,4,25,43,75,85,100,89,60,30,9,34,68,80,77,53,32,4,25,43,75,85,100,89,60,30,9,34,68,80,77,53,32,4,25,43,75,85,100,89,60,30,9,34,68,80
51,41,21,27,40,70,94,102,110,103,93,57,26,11,37,65,51,41,21,27,40,70,94,102,110,103,93,57,26,11,37,65,51,41,21,27,40,70,94,102,110,103,93,57,26,11,37,65
44,29,33,45,72,90,104,121,117,114,106,88,54,17,13,16,44,29,33,45,72,90,104,121,117,114,106,88,54,17,13,16,44,29,33,45,72,90,104,121,117,114,106,88,54,17,13,16
14,36,49,76,83,98,118,126,125,124,113,99,81,50,22,7,14,36,49,76,83,98,118,126,125,124,113,99,81,50,22,7,14,36,49,76,83,98,118,126,125,124,113,99,81,50,22,7
15,10,64,79,97,111,122,127,128,120,109,92,74,66,46,8,15,10,64,79,97,111,122,127,128,120,109,92,74,66,46,8,15,10,64,79,97,111,122,127,128,120,109,92,74,66,46,8
42,3,19,55,86,105,115,119,123,116,87,69,62,38,6,39,42,3,19,55,86,105,115,119,123,116,87,69,62,38,6,39,42,3,19,55,86,105,115,119,123,116,87,69,62,38,6,39
63,47,20,1,58,95,108,112,107,96,71,59,24,12,28,52,63,47,20,1,58,95,108,112,107,96,71,59,24,12,28,52,63,47,20,1,58,95,108,112,107,96,71,59,24,12,28,52
82,67,35,5,31,61,91,101,84,73,56,2,18,23,48,78,82,67,35,5,31,61,91,101,84,73,56,2,18,23,48,78,82,67,35,5,31,61,91,101,84,73,56,2,18,23,48,78
100,89,60,30,9,34,68,80,77,53,32,4,25,43,75,85,100,89,60,30,9,34,68,80,77,53,32,4,25,43,75,85,100,89,60,30,9,34,68,80,77,53,32,4,25,43,75,85
110,103,93,57,26,11,37,65,51,41,21,27,40,70,94,102,110,103,93,57,26,11,37,65,51,41,21,27,40,70,94,102,110,103,93,57,26,11,37,65,51,41,21,27,40,70,94,102
117,114,106,88,54,17,13,16,44,29,33,45,72,90,104,121,117,114,106,88,54,17,13,16,44,29,33,45,72,90,104,121,117,114,106,88,54,17,13,16,44,29,33,45,72,90,104,121
125,124,113,99,81,50,22,7,14,36,49,76,83,98,118,126,125,124,113,99,81,50,22,7,14,36,49,76,83,98,118,126,125,124,113,99,81,50,22,7,14,36,49,76,83,98,118,126
];
for p4=1:48:m
    for q4=1:48:n
        for i4=1:48
          for j4=1:48
            if (p4+i4-1)>m || (q4+j4-1)>n
            break
            elseif (B4(p4+i4-1,q4+j4-1)*128/255)>KK(i4,j4)
                       C4(p4+i4-1,q4+j4-1)=255;
            else 
                    C4(p4+i4-1,q4+j4-1)=0;
                   
            end
         end
        end
    end
end
figure,newmap = [0,0,0;1,1,1]; imshow(C4),title('45°加网')
imwrite(C4,'K.tif','TIFF')